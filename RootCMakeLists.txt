cmake_minimum_required(VERSION 3.8 FATAL_ERROR)
# 3.5 definite minimum

option(BUILD_PYTHON_LIBS "Build the python shared libraries" ON)

if (${BUILD_PYTHON_LIBS})
  find_package(PythonInterp REQUIRED)
  find_package(PythonLibs REQUIRED)
  find_package(Boost REQUIRED COMPONENTS python)
  include_directories(${PYTHON_INCLUDE_DIRS})
else()
  find_package(Boost REQUIRED)
endif()

find_package(TIFF REQUIRED)
find_package(OpenGL)

# Add HDF5
find_package(HDF5 REQUIRED COMPONENTS CXX)
# Hardcode link to annlib
add_library(HDF5::CXX SHARED IMPORTED)
set_target_properties(HDF5::CXX PROPERTIES
  INTERFACE_INCLUDE_DIRECTORIES ${HDF5_CXX_INCLUDE_DIRS}
  INTERFACE_COMPILE_DEFINITIONS ${HDF5_CXX_DEFINITIONS}
  IMPORTED_LOCATION             ${HDF5_CXX_LIBRARIES} )


# Convenience macro for setting up python shared libraries
# Usage: add_python_library( <name> SOURCES <file> [<file>]... )
macro(add_python_library name)
  cmake_parse_arguments(ADDPYLIB "" "" SOURCES ${ARGN})
  if (BUILD_PYTHON_LIBS)
    add_library(${name} SHARED ${ADDPYLIB_SOURCES})
    # MESSAGE(STATUS "Name: ${name} Sources: ${ADDPYLIB_SOURCES}")
    target_link_libraries(${name} ${PROJECT_NAME} Boost::python)
    set_target_properties(${name} PROPERTIES PREFIX "")
  endif()
endmacro()


add_subdirectory(annlib_adaptbx)
add_subdirectory(cbflib)
add_subdirectory(ccp4io_adaptbx)
add_subdirectory(cctbx_project)
add_subdirectory(dials)
add_subdirectory(xia2)
